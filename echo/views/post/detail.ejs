<!DOCTYPE html>
<html lang="en">
  <%- include("../header"); -%>
  <!-- 불러오기 -->

  <body>
    <%- include("../menu"); -%>

    <div class="md-form">
      <input
        type="text"
        id="title"
        class="form-control"
        value="<%= result.title %>"
        readonly
      />
      <label for="title">제목</label>
    </div>
    <div class="md-form">
      <input
        type="text"
        id="content"
        class="form-control"
        value="<%= result.content %>"
        readonly
      />
      <label for="content">내용</label>
    </div>
    <div class="md-form">
      <input
        type="text"
        id="likes"
        class="form-control"
        value="<%= result.meta.likes %>"
        readonly
      />
      <label for="likes">좋아요</label>
    </div>
    <div class="view overlay">
      <img class="card-img-top" src= "<%= result.img_url %>"" alt="post image
      cap" />
      <a href="#!">
        <div class="mask rgba-white-slight"></div>
      </a>
    </div>

    <% if (user.idx === result.writer.idx) { %>
    <button
      type="button"
      class="btn btn-primary"
      onclick="location.href='/post/_id/<%= result._id %>/edit'"
    >
      수정
    </button>
    <button id="deleteBtn" type="button" class="btn btn-primary">삭제</button>

    <%- include("../footer.ejs"); -%>

    <script>
      $(function () {
        $("#deleteBtn").on("click", () => {
          event.preventDefault();
          if (confirm("삭제하시겠습니까?")) {
            $.ajax({
              url: "/post/_id/<%= result._id %>",
              type: "DELETE",
            })
              .done(() => {
                location.href = "/post/list";
              })
              .fail((request, status, error) => {
                alert(request.responseText);
              });
          } else {
            // 취소
          }
        });
      });
    </script>
    <% } else { %> <% if (result.liked_people_idxs.includes(user.idx)) { %>
    <button id="unLikeBtn" type="button" class="btn btn-danger">
      좋아요 취소 <% } else { %>
      <button id="likeBtn" type="button" class="btn btn-primary">
      좋아요 <% } %>
    </button>
    <%- include("../footer.ejs"); -%>

    <script>
      $(function () {
        $("#likeBtn").on("click", () => {
          event.preventDefault();
            $.ajax({
              url: "/post/_id/<%= result._id %>/like",
              type: "GET",
            })
              .done(() => {
                window.location.reload()
              })
              .fail((request, status, error) => {
                alert(request.responseText);
              });
        });
      });
    </script>
    
    <script>
      $(function () {
        $("#unLikeBtn").on("click", () => {
          event.preventDefault();
            $.ajax({
              url: "/post/_id/<%= result._id %>/unlike",
              type: "GET",
            })
              .done(() => {
                window.location.reload()
              })
              .fail((request, status, error) => {
                alert(request.responseText);
              });
        });
      });
    </script>
    <% } %>
  </br>
  <div>
    <h3> 댓글 : <%= result.comments.lenth %> </h3>

    <!-- Card deck -->
    <div class="row row-cols-1 row-cols-md-1">
    <% result.comments.forEach(comment => { %>

    <!-- Card -->
<div class="card mb-4">

  <!-- Card content -->
  <div class="card-body">

    <!-- Title -->
    <h4 class="card-title"><%= comment.title %></h4>
    <hr>
    <!-- Text -->
    <p class="card-text"><%= comment.content %></p>

  </div>

  <!-- Card footer -->
  <div class="rounded-bottom mdb-color lighten-3 text-center pt-3">
    <ul class="list-unstyled list-inline font-small">
      <li class="list-inline-item pr-2 white-text"><i class="far fa-clock pr-1"></i><%=comment.date.toISOString().replace(/T/, ' ').
        replace(/\..+/, '')%></li>
      <li class="list-inline-item pr-2"><a href="#" class="white-text"><i
            class="far fa-comments pr-1"></i>12</a></li>
      <li class="list-inline-item"><a href="#" class="white-text"> 작성자 : <%= comment.writer.name %></a> </li>
    </ul>
  </div>

</div>
<!-- Card -->
<% }) %>
</div>
<!-- Card deck -->

  </div>
  </body>
</html>
